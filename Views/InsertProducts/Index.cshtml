@model InsertProductViewModel;

@{
    ViewData["title"] = "Cadastrar Produtos";
}
    
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet"
      integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
<link rel="stylesheet" href="css/insertStyle.css">
<link rel="stylesheet" href="css/indexStyle.css">

<body>
    <div class="insertBanner"><img src="icons/InsiraProdutos.png"></div>

    <div class = "containerInsert">
        <div class="columnSheet">
            <table class="tableColumnSheet">
                <thead>
                    <tr>
                        <th><button class="insertButton" data-bs-toggle="modal" data-bs-target="#productForm">Inserir</button></th>
                    </tr>
                    <tr>
                        <th>Id</th>
                        <th>Produto</th>
                        <th>Nome</th>
                        <th>Preço</th>
                        <th>Tipo</th>
                    </tr>
                </thead>

                <tbody id="data">
           
    @if(Model != null)
    {
        foreach (var product in Model.ProductList)
        {
            <tr class="productDetails">
                <td>@product.Id</td>
                <td><img src=@product.ImgUrl></td>
                <td>@product.Name</td>
                <td>@product.Price.ToString("C")</td>
                <td>@product.Type</td>
                
                <td>

                    <button type="button" class="editButton" data-bs-toggle="modal" data-bs-target="#productForm" data-product-id="@product.Id">Editar</button>
                    
                    <form asp-controller="InsertProducts" asp-action="Delete" method="post" style="display:inline;">
                        @Html.AntiForgeryToken()
                        <input type="hidden" name="Id" value="@product.Id"/>    
                        <button type="submit" class="deleteButton" onclick="return confirm('Deseja deletar esse produto?');">Deletar</button>
                    </form>

                </td>
            </tr>
        }
    }
                </tbody>
            </table>
        </div>
    </div>

    <!--Usando modal para fazer a sobreposição da tela de adicionar/editar item-->
        <div class="modal fade" id="productForm">
            <div class="modal-dialog modal-dialog-centered modal-lg">
                <div class="modal-content">
                    <div class="modal-header">
                        <h4 class="modal-title">Preencha os requisitos</h4>
                        <button type="button" class="buttonClose" data-bs-dismiss="modal" aria-label="Close"><img src="icons/closeIcon.png"></button>     
                    </div>
                    
                    <div class ="modal-body">

                        <form method="post" asp-controller="InsertProducts" asp-action="Create" id="productRegister" enctype="multipart/form-data">
                            
                            @Html.AntiForgeryToken()

                            <div asp-validation-summary="ModelOnly" class="text-danger"></div>
                            
                            <div class="modalImgHolder">
                                <label for="ImgUrl" class="upload">
                                    <input type="file" asp-for="NewProduct.ImageFile" id="imgInput">
                                </label>
                                <img src="icons/imgHolderIcon.png" alt="" class="img">
                            </div>

                            <div class="inputField">
                                    <input type="hidden" asp-for="NewProduct.Id" id="productId"/>
                                <div>
                                    <label for="name">Nome:</label>
                                    <input type="text" asp-for="NewProduct.Name" id="name">
                                    <span asp-validation-for="NewProduct.Name" class="text-danger"></span>
                                </div>
                                <div>
                                    <label for="price">Preço:</label>
                                    <input type="text" asp-for="NewProduct.Price" id="price">
                                    <span asp-validation-for="NewProduct.Price" class="text-danger"></span>
                                </div>
                                <div>
                                    <label for="type">Tipo:</label>
                                    <input type="text" asp-for="NewProduct.Type" list="types" id="type">
                                    <span asp-validation-for="NewProduct.Type" class="text-danger"></span> 
                                        
                                        <datalist id="types">
                                            <option value ="Camiseta"></option>
                                            <option value="Caneca"></option>
                                            <option value="Calçado"></option>
                                        </datalist>
                                </div>
                            </div>
                        </form>
                    </div>
                    
                    <div class="modal-footer">
                            <button type="submit" form="productRegister" class="buttonRegister">Cadastrar</button>
                    </div>
                </div>
            </div>
        </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"
            integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM" crossorigin="anonymous">
    </script>
    @section Scripts {
    @{
        await Html.RenderPartialAsync("_ValidationScriptsPartial");

        <script type="text/javascript">
            $.validator.methods.number = function (value, element){
            return this.optional(element) || /^-?(?:\d+|\d{1,3}(?:[\s\.,]\d{3})+)(?:[\.,]\d+)?$/.test(value);
            }
        </script>
        <script src="~/js/InsertProduct.js" defer></script>
        }
    }
</body>